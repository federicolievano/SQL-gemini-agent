name: CD Pipeline - Deploy to Streamlit Cloud

# Â¿CuÃ¡ndo se ejecuta este workflow?
on:
  # Solo se ejecuta cuando el CI pasa exitosamente
  workflow_run:
    workflows: ["CI Pipeline - SQL Query Assistant"]
    types: [completed]
    branches: [main, master]

# Â¿QuÃ© hace este workflow?
jobs:
  # Job 1: Verificar que el CI pasÃ³
  check-ci:
    name: âœ… Verify CI Success
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸ” Check CI status
        run: |
          if [ "${{ github.event.workflow_run.conclusion }}" != "success" ]; then
            echo "âŒ CI failed, skipping deployment"
            exit 1
          fi
          echo "âœ… CI passed, proceeding with deployment"
      
      - name: ðŸš€ Prepare for deployment
        run: |
          echo "ðŸš€ Application ready for deployment to Streamlit Cloud"
          echo "ðŸ“‹ Next steps:"
          echo "1. Go to https://share.streamlit.io/"
          echo "2. Connect your GitHub repository"
          echo "3. Deploy automatically on each push"
      
      - name: ðŸ“Š Create deployment summary
        run: |
          echo "## ðŸŽ‰ CI/CD Pipeline Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **Code Quality**: Passed" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **Security Scan**: Passed" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **Application Tests**: Passed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸš€ **Ready for Deployment**: Streamlit Cloud" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“‹ **Deployment Steps**:" >> $GITHUB_STEP_SUMMARY
          echo "1. Visit [Streamlit Cloud](https://share.streamlit.io/)" >> $GITHUB_STEP_SUMMARY
          echo "2. Connect your GitHub repository" >> $GITHUB_STEP_SUMMARY
          echo "3. Deploy automatically on each push" >> $GITHUB_STEP_SUMMARY

  # Job 2: Notificar Ã©xito
  notify-success:
    name: ðŸ“¢ Notify Success
    runs-on: ubuntu-latest
    needs: check-ci
    
    steps:
      - name: ðŸŽ‰ Deployment Ready
        run: |
          echo "ðŸŽ‰ Your SQL Query Assistant is ready for deployment!"
          echo ""
          echo "ðŸ“‹ What happens next:"
          echo "1. CI pipeline passed all checks âœ…"
          echo "2. Code is formatted and tested âœ…"
          echo "3. Ready for Streamlit Cloud deployment âœ…"
          echo ""
          echo "ðŸš€ Next step: Deploy to Streamlit Cloud" 